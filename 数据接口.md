# 1  概述

本文档为八维通与外部系统的接口说明，文档定义了双方系统的接口流程、接口协议、接口数据内容，作为为双方系统接口对接的设计、开发以及测试依据。

# 2  接口协议

## 2.1 接口协议格式

接口采用HTTP协议，使用POST方式提交，请求参数字符集编码为UTF-8，返回结果默认为JSON格式，如有特殊格式会在具体的接口定义中明确说明。

## 2.2 接口调用规范

### 2.2.1    调用入口

接口调用地址：http://IP:PORT/api/[rest]，rest地址在各接口中明确。

### 2.2.2    HTTP请求头

| 名称       | 类型   | 长度 | 说明                                                         |
| ---------- | ------ | ---- | ------------------------------------------------------------ |
| appid      | string | F32  | 八维通分配给开发者/商户的appid                               |
| token      | string | F32  | 用户登录后返回的token，需要用户授权的接口必须传此参数        |
| random     | String | F172 | 加密后的随机码，当报文中有需要加密的字段的时候需要传此参数   |
| sequence   | string | F24  | yyyyMMddHHmmss+10位数字（在一定时间内不重复），仅作为接口调用跟踪用途，不作为业务用途，业务流水在业务接口中定义。 |
| version    | string | V6   | App版本号，如：1.2、1.1.11。                                 |
| signature  | string | F172 | 签名，由请求方生成，参见《[签名算法](#_签名算法)》           |
| deviceId   | string | F64  | 设备id                                                       |
| deviceType | string | F64  | 设备类型                                                     |
| appType    | string | F64  | app类型                                                      |
| cityId     | string | F64  | 城市id                                                       |
| bundleId   | string | F64  | app唯一标识                                                  |
| userId     | string | F64  | 用户ID                                                       |

 

### 2.2.3    HTTP应答头

| 名称      | 类型   | 长度 | 说明                                               |
| --------- | ------ | ---- | -------------------------------------------------- |
| sequence  | string | F24  | 原样返回合作机构的流水                             |
| signature | string | F172 | 签名，由应答方生成，参见《[签名算法](#_签名算法)》 |

 

### 2.2.4    请求公共参数

| 名称 | 类型 | 长度 | 说明 |
| ---- | ---- | ---- | ---- |
|      |      |      |      |

 

### 2.2.5    应答公共参数

| 名称    | 类型   | 长度 | 说明         |
| ------- | ------ | ---- | ------------ |
| errcode | string | F4   | 错误代码     |
| errmsg  | string | V256 | 错误代码描述 |

 

## 2.3 签名算法

为了防止API调用过程中被黑客恶意篡改，调用任何一个API都需要携带签名，服务端会根据请求参数，对签名进行验证，签名不合法的请求将会被拒绝。目前支持的签名算法采用MD5，签名大体过程如下：

1、 转换：将请求参数转换为json消息。

2、 摘要：把转换好的字符串采用utf-8编码，使用摘要算法对编码后的字节流进行摘要。使用MD5算法，对转换后的字符串进行摘要，如：md5(json)；

3、 将摘要得到的字节流结果使用十六进制大写表示，如：hex(“helloworld”.getBytes(“utf-8”)) = “68656C6C6F776F726C64”

4、 签名：使用加密算法对摘要后的16进制文本进行加密。使用RSA算法，1024位，填充方式采用RSA/ECB/PKCS1Padding，如RSA(“ 68656C6C6F776F726C64”, key)。

 

## 2.4 验签过程

1、 摘要：将接收到的请求报文json采用utf-8编码，使用摘要算法对编码后的字节流进行摘要。使用MD5算法，对请求报文进行摘要，如：md5(json)

2、 将摘要得到的字节流结果使用十六进制大写表示，如：A=hex(“helloworld”.getBytes(“utf-8”)) = “68656C6C6F776F726C64”

3、 解密签名：使用加密算法对报文头中的签名进行解密。使用RSA算法，如B=RSA(“ 68656C6C6F776F726C64”, key)

4、 验签：比对摘要得到的十六进制字符串A和解密后的签名B是否一致，若一致则验签成功。

## 2.5 加密算法

为了防止敏感信息泄露，敏感字段需要加密传输，加密算法RSA+AES。

l 请求报文：

1、 合作商户生成8位数字+字母组合随机码，并使用八维通公布的公钥进行加密，将加密后的随机码放置在报文中的random字段。

2、 使用AES算法对敏感字段（登陆中的密码）进行加密。

A=AES. encryptToHex (password,random)

l 应答报文：使用请求报文中的random进行用AES算法解密。

password =AES. decryptFromHex(A,random)

注：AES算法使用AES/ECB/PKCS5Padding方式，128位秘钥。

## 2.6 错误代码定义

| 编码 | 含义                                   |
| ---- | -------------------------------------- |
| 0000 | 处理成功                               |
| 0001 | appid不合法                            |
| 0002 | 签名验证失败                           |
| 0003 | 没有权限                               |
| 0004 | 参数错误                               |
| 0005 | 登录已失效，请重新登录。               |
| 0006 | 接口不存在                             |
| 0009 | App唯一标识为空！                      |
| 0010 | 处理失败                               |
| 0011 | 必填参数不能为空                       |
| 0012 | 输入参数不正确                         |
| 0013 | 终端识别码错误                         |
| 0014 | 城市选择错误                           |
| 0015 | 该城市仅向内测用户开放，请选择其他城市 |
| 0016 | 该功能仅向内测用户开放                 |
| 0017 | 系统繁忙，请稍候再试                   |
| 0901 | 系统异常                               |
| 0902 | 数据为空                               |
| 0088 | 版本号不支持                           |
| 9999 | 未知错误                               |

 

|      |      |
| ---- | ---- |
|      |      |

 

## 2.7 约定

\1.  本文档中使用的时间统一采用YYYY/MM/DD HH24:MI:SS格式。

\2.  每次交互设置交易时限【交限时限定为30秒】，如接口发起方在交易时限内未收到接口服务应答包，则交易失败，接口发起方应停止接收。对于耗时的业务，需考虑异步回调通知的方式。

\3.  在本文档中以表格的形式表示JSON格式，以下为表格中对元素约束（出现次数）的表示方法的描述：

| 符号 | 含义                                  |
| ---- | ------------------------------------- |
| ?    | 0..1，可选项                          |
| *    | 0..n，可以没有，也可以有多项（数组）  |
| +    | 1..n，至少有1项，也可以有多项（数组） |
| 1    | 数字1，代表必须且只能填1项            |

另外，在报文格式的宽度中，“F”指固定长度，“V”表示可变长度。

 

# 3  业务字典定义

## 3.1 城市ID定义



**字段名称约定：**CITY_ID

 

| 数据项 | 取值 | 类型 | 长度 | 描述 |
| ------ | ---- | ---- | ---- | ---- |
| 全国   | 86   |      |      |      |
| 天津   | 12   |      |      |      |
| 无锡   | 3202 |      |      |      |
| 苏州   | 3205 |      |      |      |
| 福州   | 3501 |      |      |      |
|        |      |      |      |      |
|        |      |      |      |      |

 

## 3.2 服务类型定义



**字段名称约定：SERVICE_ID**

 

| 数据项 | 取值 | 类型 | 长度 | 描述   |
| ------ | ---- | ---- | ---- | ------ |
| 不限   | 00   |      | 2    | 不限   |
| 地铁   | 01   |      | 2    | 地铁   |
| 公交   | 02   |      | 2    | 公交   |
| 自行车 | 03   |      | 2    | 自行车 |
| 高铁   | 06   |      | 2    | 高铁   |

## 3.3 站点、线路定义

**字段名称约定：****STATION_NO**

### 3.3.1    无锡（3202）

 

| CITY_ID | STATION_ID       | STATION_NAME | STATION_NO |
| ------- | ---------------- | ------------ | ---------- |
| 3202    | 1363613991735290 | 堰桥         | 101        |
| 3202    | 1363613991735290 | 锡北运河     | 102        |
| 3202    | 1363613991735290 | 西漳         | 103        |
| 3202    | 1363613991735290 | 天一         | 104        |
| 3202    | 1363613991735300 | 刘潭         | 105        |
| 3202    | 1363613991735300 | 庄前         | 106        |
| 3202    | 1363613991735300 | 民丰         | 107        |
| 3202    | 1363613991735300 | 无锡火车站   | 108        |
| 3202    | 1363613991735300 | 胜利门       | 109        |
| 3202    | 1363613991735300 | 三阳广场     | 110        |
| 3202    | 1363613991735300 | 南禅寺       | 111        |
| 3202    | 1363613991735300 | 谈渡桥       | 112        |
| 3202    | 1363613991735300 | 太湖广场     | 113        |
| 3202    | 1363613991735300 | 清名桥       | 114        |
| 3202    | 1363613991735310 | 人民医院     | 115        |
| 3202    | 1363613991735310 | 华清大桥     | 116        |
| 3202    | 1363613991735310 | 扬名         | 117        |
| 3202    | 1363613991735310 | 南湖家园     | 118        |
| 3202    | 1363613991735310 | 塘铁桥       | 119        |
| 3202    | 1363613991735310 | 金匮公园     | 120        |
| 3202    | 1363613991735310 | 市民中心     | 121        |
| 3202    | 1363613991735310 | 文化宫       | 122        |
| 3202    | 1363613991735310 | 江南大学     | 123        |
| 3202    | 1363613991735310 | 长广溪       | 124        |
| 3202    | 1363613991735320 | 梅园开原寺   | 201        |
| 3202    | 1363613991735320 | 荣巷         | 202        |
| 3202    | 1363613991735320 | 小桃源       | 203        |
| 3202    | 1363613991735320 | 河埒口       | 204        |
| 3202    | 1363613991735320 | 大王基       | 205        |
| 3202    | 1363613991735320 | 梁溪大桥     | 206        |
| 3202    | 1363613991735320 | 五爱广场     | 207        |
| 3202    | 1363613991735320 | 东林广场     | 209        |
| 3202    | 1363613991735320 | 上马墩       | 210        |
| 3202    | 1363613991735320 | 靖海         | 211        |
| 3202    | 1363613991735330 | 广益         | 212        |
| 3202    | 1363613991735330 | 柏庄         | 213        |
| 3202    | 1363613991735330 | 东亭         | 214        |
| 3202    | 1363613991735330 | 庄桥         | 215        |
| 3202    | 1363613991735330 | 云林         | 216        |
| 3202    | 1363613991735330 | 九里河公园   | 217        |
| 3202    | 1363613991735330 | 查桥         | 218        |
| 3202    | 1363613991735330 | 映月湖公园   | 219        |
| 3202    | 1363613991735330 | 迎宾广场     | 220        |
| 3202    | 1363613991735330 | 无锡东站     | 221        |
| 3202    | 1363613991735340 | 安镇         | 222        |
| 3202    | 1363613991735340 | 苹果园       | 223        |
| 3202    | 1363613991735340 | 天安门       | 223        |
| 3202    | 1363613991735340 | 土桥         | 223        |
| 3202    | 1363613991735340 | 东直门       | 223        |
| 3202    | 1363613991735340 | 复兴门       | 223        |
| 3202    | 1363613991735340 | 建国门       | 223        |
| 3202    | 1363613991735340 | 安河桥北     | 223        |
| 3202    | 1363613991735340 | 西直门       | 223        |
| 3202    | 1363613991735340 | 天宫院       | 223        |

 

## 3.4 行程状态定义



字段名称约定：status

| 数据项 | 取值 | 类型    | 长度 | 描述 |
| ------ | ---- | ------- | ---- | ---- |
| 未进站 | 0    | Integer | 3    |      |
| 行程中 | 1    | Integer | 3    |      |
| 待支付 | 2    | Integer | 3    |      |
| 已付款 | 3    | Integer | 3    |      |

 

## 3.5 行程支付类型定义

字段名称约定：pay_type_h5，over_time_pay_type_h5



| 数据项       | 取值 | 类型    | 长度 | 描述 |
| ------------ | ---- | ------- | ---- | ---- |
| `次卡 `      | 0    | Integer | 3    |      |
| `现金`       | 2    | Integer | 3    |      |
| `乘车票`     | 31   | Integer | 3    |      |
| `绑卡支付`   | 8    | Integer | 3    |      |
| `支付宝代扣` | 9    | Integer | 3    |      |
| `微信代扣`   | 10   | Integer | 3    |      |

 

# 4  接口定义

## 4.1  用户模块

### 4.1.1    获取用户信息



| URI      | /app/user/getUserInfo                           |
| -------- | ----------------------------------------------- |
| 功能描述 | 获取用户信息                                    |
| 备注     | 为了和新协议的编码规范一致，采用a_b下划线的形式 |

² **请求内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注**                           |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | ---------------------------------- |
|                | user_id      | ?        | Integer  | F16      | 用户id       |                                    |
|                | term_type    | ?        | integer  | F2       | 终端类型     | 终端类型0安卓1苹果   --device_type |
|                | term_token   | ?        | string   | V32      | 设备唯一id   | 终端识别码   --divice_id           |

² **应答内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注**                            |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | ----------------------------------- |
|                | result       | *        | struct   | -        | 返回结果     |                                     |
| result         | user         | 1        | struct   | -        | 用户信息     | 引5.1[用户基础信息](#_用户基础信息) |
| result         | token        | 1        | string   | V32      | token信息    |                                     |

 

² **返回码：**



| **编码** | **说明**                     |
| -------- | ---------------------------- |
| 0000     | 处理成功                     |
| 0001     | 处理失败                     |
| 0100     | 您还不是会员，现在去注册吧。 |
| 0131     | 用户id为空                   |

 



## 4.2  行程模块

### 4.2.1   行程列表



| URI      | /app/trip/baseTriplist |
| -------- | ---------------------- |
| 功能描述 | 用户行程列表的获取     |

² **请求内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注**                           |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | ---------------------------------- |
|                | service_id   | ？       | string   | V4       | 服务id       | 参考字典[服务类型](#_服务类型定义) |
|                | trip_flag    | 1        | string   | F4       | 行程标识     | 00：全部   01：行程中   02：已完成 |
|                | page_no      | 1        | integer  | V11      | 当前页码,    | 从1开始                            |
|                | page_size    | 1        | integer  | V11      | 每页记录数   |                                    |

² **应答内容：**



| **父元素名称**       | **元素名称**          | **约束** | **类型** | **宽度** | **参数描述**       | **备注**                                                |
| -------------------- | --------------------- | -------- | -------- | -------- | ------------------ | ------------------------------------------------------- |
|                      | page                  | 1        | struct   | -        | 页                 |                                                         |
| page                 | total_count           | 1        | integer  | V11      | 总条数             |                                                         |
| page                 | page_no               | 1        | integer  | V11      | 当前页码,          | 从1开始                                                 |
| page                 | page_size             | 1        | integer  | V11      | 每页记录数         |                                                         |
| page                 | total_page            | 1        | integer  | V11      | 总页数             |                                                         |
| page                 | rows                  | *        | struct   | -        | 记录列表           |                                                         |
| **行程本身的信息**   |                       |          |          |          |                    |                                                         |
| rows                 | trip_no               | ？       | string   | V20      | 行程单号           |                                                         |
| rows                 | city_id               | 1        | integer  | F20      | 城市id             |                                                         |
| rows                 | service_id            | 1        | string   | V4       | 服务id             | 参考字典[服务类型](#_服务类型定义)                      |
| rows                 | in_station_id         | 1        | string   | V20      | 进站站点id         |                                                         |
| rows                 | in_station_name       | 1        | string   | V20      | 进站站点名称       |                                                         |
| rows                 | in_line_id            | 1        | string   | V20      | 线路id(进)         |                                                         |
| rows                 | in_line_name          | 1        | string   | V2       | 线路名称（进）     |                                                         |
| rows                 | in_time               | 1        | string   | V20      | 进站时间           | yyyy/MM/dd HH:mm:ss                                     |
| rows                 | out_station_id        | 1        | string   | V20      | 出站站点id         |                                                         |
| rows                 | out_station_name      | 1        | string   | V20      | 出站站点名称       |                                                         |
| rows                 | out_line_id           | 1        | string   | V20      | 线路id(出)         |                                                         |
| rows                 | out_line_name         | 1        | string   | V20      | 线路名称（出）     |                                                         |
| rows                 | out_time              | 1        | string   | V20      | 出站时间           | yyyy/MM/dd HH:mm:ss                                     |
| rows                 | mileage               | 1        | integer  | F2       | 里程               |                                                         |
| rows                 | status                | 1        | string   | F2       | 行程状态           | 参考字典[行程状态](#_行程状态定义)                      |
| **行程总的扣费信息** |                       |          |          |          |                    |                                                         |
| rows                 | trip_total_fee        | 1        | integer  | F8       | 行程总基础费用     | 单位：分                                                |
| rows                 | trip_total_actual_fee | 1        | integer  | F8       | 行程支付实际总费用 | 单位：次或者分                                          |
| **正常扣费信息**     |                       |          |          |          |                    |                                                         |
| rows                 | amount                | 1        | integer  | F8       | 实际支付金额       | 行程支付费用：单位：次或者分  备注：次为计次卡的次数    |
| rows                 | base_fee              | 1        | integer  | F8       | 标准费用           | 行程基础费用：单位：分                                  |
| rows                 | pay_type              | 1        | integer  | F1       | 支付类型           | 0-次卡 1-金额                                           |
| rows                 | pay_type_h5           | 1        | integer  | F1       | 支付类型           | H 5页面专用，参考字典[行程支付类型](#_行程支付类型定义) |
| rows                 | pay_time              | 1        | string   | V20      | 支付时间           | yyyy/MM/dd HH:mm:ss                                     |
| rows                 | bill_id               | 1        | string   | F20      | 正常扣费的账单id   |                                                         |

 

### 4.2.2   行程详情



| URI      | /app/trip/getBaseTrip                                   |
| -------- | ------------------------------------------------------- |
| 功能描述 | 用户行程详情获取                                        |
| 备注     | 要考虑超时扣罚时有两笔扣款，接口如何调整、APP端如何展示 |

 

² **请求内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注**                           |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | ---------------------------------- |
|                | trip_no      | 1        | string   | V16      | 行程单号     |                                    |
|                | service_id   | 1        | string   | F4       | 服务id       | 参考字典[服务类型](#_服务类型定义) |

² **应答内容：**



| **父元素名称**       | **元素名称**          | **约束** | **类型** | **宽度** | **参数描述**       | **备注**                                               |
| -------------------- | --------------------- | -------- | -------- | -------- | ------------------ | ------------------------------------------------------ |
|                      | trip                  | *        | struct   | -        | 行程记录           |                                                        |
| **行程本身的信息**   |                       |          |          |          |                    |                                                        |
| trip                 | trip_no               | ？       | string   | V20      | 行程单号           |                                                        |
| trip                 | consumer_id           | 1        | long     | V20      | 计费侧行程号       |                                                        |
| trip                 | city_id               | 1        | integer  | F20      | 城市id             |                                                        |
| trip                 | service_id            | 1        | string   | V4       | 服务id             | 参考字典[服务类型](#_服务类型定义)                     |
| trip                 | in_station_id         | 1        | string   | V20      | 进站站点id         |                                                        |
| trip                 | in_station_name       | 1        | string   | V20      | 进站站点名称       |                                                        |
| trip                 | in_line_id            | 1        | string   | V20      | 线路id(进)         |                                                        |
| trip                 | in_line_name          | 1        | string   | V2       | 线路名称（进）     |                                                        |
| trip                 | in_time               | 1        | string   | V20      | 进站时间           | yyyy/MM/dd HH:mm:ss                                    |
| trip                 | out_station_id        | 1        | string   | V20      | 出站站点id         |                                                        |
| trip                 | out_station_name      | 1        | string   | V20      | 出站站点名称       |                                                        |
| trip                 | out_line_id           | 1        | string   | V20      | 线路id(出)         |                                                        |
| trip                 | out_line_name         | 1        | string   | V20      | 线路名称（出）     |                                                        |
| trip                 | out_time              | 1        | string   | V20      | 出站时间           | yyyy/MM/dd HH:mm:ss                                    |
| trip                 | mileage               | 1        | integer  | F2       | 里程               |                                                        |
| trip                 | status                | 1        | string   | F2       | 行程状态           | 参考字典[行程状态](#_行程状态定义)                     |
| **行程总的扣费信息** |                       |          |          |          |                    |                                                        |
| trip                 | trip_total_fee        | 1        | integer  | F8       | 行程总基础费用     | 单位：分                                               |
| trip                 | trip_total_actual_fee | 1        | integer  | F8       | 行程支付实际总费用 | 单位：次或者分                                         |
| **正常扣费信息**     |                       |          |          |          |                    |                                                        |
| trip                 | amount                | 1        | integer  | F8       | 实际支付金额       | 行程支付费用：单位：次或者分  备注：次为计次卡的次数   |
| trip                 | base_fee              | 1        | integer  | F8       | 标准费用           | 行程基础费用：单位：分                                 |
| trip                 | pay_result            | 1        | integer  | F8       | 扣费结果           | 1-支付成功 2-支付失败                                  |
| trip                 | pay_type              | 1        | integer  | F1       | 支付类型           | 0-次卡 1-金额                                          |
| trip                 | pay_type_h5           | 1        | integer  | F1       | 支付类型           | H5页面专用，参考字典[行程支付类型](#_行程支付类型定义) |
| trip                 | pay_time              | 1        | string   | V20      | 支付时间           | yyyy/MM/dd HH:mm:ss                                    |
| trip                 | bill_id               | 1        | string   | F20      | 正常扣费的账单id   |                                                        |

 

## 4.3  消息模块

### 4.3.1    消息推送



| URI      | /app/message/push |
| -------- | ----------------- |
| 功能描述 | 消息推送          |

² **请求内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注**                                              |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | ----------------------------------------------------- |
|                | msg_type     | 1        | integer  | V1       | 消息类型     | 消息类型   4：服务消息                                |
|                | relation_id  | ？       | string   | V20      | 业务id       | 关联的业务id –测试可以随便输入，不超过64位  eg:订单id |
|                | msg_title    | 1        | string   | F19      | 消息标题     | eg.系统消息                                           |
|                | msg_content  | 1        | string   | F19      | 消息内容     | 推送主要内容                                          |
|                | remark       | ？       | string   | V20      | 备注         | 备注信息                                              |

² **应答内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注** |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | -------- |
|                |              |          |          |          |              |          |

² **返回码：**



| **编码** | **说明** |
| -------- | -------- |
|          |          |

### 4.3.2 根据消息类型获取消息（行程通知）



| URI      | /app/message/list/by/type              |
| -------- | -------------------------------------- |
| 功能描述 | 根据消息类型获取消息，更新消息是否已读 |

² **请求内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注**                             |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | ------------------------------------ |
|                | user_id      | 1        | bigint   | V64      | 用户Id       |                                      |
|                | msg_type     | 1        | int      | F1       | 消息类型     | 消息类型   0：支付消息   1：行程通知 |
|                | current_page | 1        | int      | V11      | 当前页       |                                      |
|                | page_size    | 1        | int      | V11      | 每页显示数   |                                      |

² **应答内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述**   | **备注**                           |
| -------------- | ------------ | -------- | -------- | -------- | -------------- | ---------------------------------- |
|                | messages     | 1        | struct   | -        | 返回消息内容   |                                    |
| messages       | row          | *        | struct   | -        | 每条消息内容   |                                    |
| row            | send_id      | 1        | Long     | F20      | 消息id         |                                    |
| row            | user_id      | 1        | Long     | F20      | 用户id         |                                    |
| row            | msg_type     | 1        | Integer  | F1       | 消息类型       | 0-支付消息   1-行程消息            |
| row            | msg_title    | 1        | String   | F64      | 消息标题       |                                    |
| row            | msg_content  | 1        | String   | V512     | 消息内容       |                                    |
| row            | relation_id  | 1        | String   | F1       | 关联的业务编号 |                                    |
| row            | request_time | 1        | date     | F19      | 发送时间       | 格式：yyyy/MM/dd HH:mm:ss          |
| row            | read_status  | 1        | Integer  | F1       | 阅读状态       | 0-未读 1-已读                      |
| row            | city_id      | 1        | Integer  | F8       | 城市id         |                                    |
| row            | service_id   | 1        | String   | F2       | 服务类型       | 参考字典[服务类型](#_服务类型定义) |

² **返回码：**



| **编码** | **说明** |
| -------- | -------- |
|          |          |

## 4.4  其他模块

### 4.4.1 查询地铁路线站点



| URI      | /metro/station/find |
| -------- | ------------------- |
| 功能描述 | 查询地铁路线        |

² **请求内容：**



| **父元素名称** | **元素名称**      | **约束** | **类型** | **宽度** | **参数描述**       | **备注**                                  |
| -------------- | ----------------- | -------- | -------- | -------- | ------------------ | ----------------------------------------- |
|                | ver               | ？       | string   | F32      | 新版本标识         | eg: msx-2.0                               |
|                | city_id           | 1        | int      | V11      | 城市ID             |                                           |
|                | last_line_time    | ?        | datetime | F19      | 线路最后更新的时间 | --不传，代表全量更新  yyyy/MM/dd HH:mm:ss |
|                | last_station_time | ?        | datetime | F19      | 站点最后更新时间   | --不传代表全量更新  yyyy/MM/dd HH:mm:ss   |

 

² **应答内容：**



| **父元素名称** | **元素名称**          | **约束** | **类型** | **宽度** | **参数描述**                 | **备注**               |
| -------------- | --------------------- | -------- | -------- | -------- | ---------------------------- | ---------------------- |
|                | page                  | 1        | struct   | -        | 页                           |                        |
| page           | line_sta              | *        | struct   | -        | 线路站点                     |                        |
| line_sta       | line_id               | 1        | integer  | V11      | 线路Id                       |                        |
| line_sta       | line_name             | 1        | string   | V11      | 线路名称                     |                        |
| line_sta       | line_modify_status    | 1        | string   | F4       | 线路更新状态                 | 1-新增 2-修改 3-删除   |
| line_sta       | station               | *        | struct   | -        | 站点数据                     |                        |
| station        | station_id            | 1        | integer  | V20      | 站点id                       |                        |
| station        | station_name          | 1        | string   | F1       | 站点名称                     |                        |
| station        | station_no            | 1        | integer  | F1       | 站点编号                     |                        |
| station        | station_phone         | 1        | string   | V20      | 站点电话                     |                        |
| station        | station_modify_status | 1        | string   | F4       | 站点更新状态                 | 1-新增 2-修改 3-删除   |
| page           | sta_chg               | 1        | long     | F32      | 站点表最后更新时间戳         |                        |
| page           | line_chg              | 1        | long     | F32      | 线路表最后更新时间戳         |                        |
| page           | rel_chg               | 1        | long     | F32      | 线路站点关系表最后更新时间戳 |                        |
| page           | last_line_time        | 1        | datetime | F19      | 线路最后更新的时间           | -- yyyy/MM/dd HH:mm:ss |
| page           | last_station_time     | 1        | datetime | F19      | 站点最后更新时间             | -- yyyy/MM/dd HH:mm:ss |

 

² **返回码：**



| **编码** | **说明** |
| -------- | -------- |
|          |          |



 

### 4.4.2 查询用户画像信息



| URI      | /portrait/getUserPortrait |
| -------- | ------------------------- |
| 功能描述 | 查询用户画像标签          |

² **请求内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述** | **备注** |
| -------------- | ------------ | -------- | -------- | -------- | ------------ | -------- |
|                | city_id      | 1        | int      | V11      | 城市ID       |          |

 

² **应答内容：**



| **父元素名称** | **元素名称** | **约束** | **类型** | **宽度** | **参数描述**     | **备注**                            |
| -------------- | ------------ | -------- | -------- | -------- | ---------------- | ----------------------------------- |
| result         | portrais     | 1        | struct   | -        | 用户画像标签信息 | 引5.2[用户画像信息](#_用户画像信息) |

 

² **返回码：**



| **编码** | **说明** |
| -------- | -------- |
|          |          |

 

 

# 5  基础数据定义

## 5.1 用户基础信息



| **元素名称**    | **类型** | **约束** | **宽度** | **参数描述** | **备注**                     |
| --------------- | -------- | -------- | -------- | ------------ | ---------------------------- |
| user            | struct   | 1        | -        |              |                              |
| user_id         | integer  | 1        | F16      | 用户id       |                              |
| user_name       | string   | 1        | V64      | 用户姓名     |                              |
| sex             | integer  | ？       | F2       | 用户性别     | 0-保密1-男2-女               |
| mobile_phone    | string   | 1        | F20      | 用户手机号码 |                              |
| profession      | string   | ？       | F64      | 用户职业     |                              |
| id_no           | string   | ？       | F32      | 证件号码     |                              |
| id_type         | integer  | ？       | F2       | 证件类型     | 1-身份证                     |
| birthday        | datetime | ？       | F19      | 用户生日     |                              |
| user_image_path | string   | ？       | V64      | 用户头像路径 |                              |
| nickname        | string   | ？       | F64      | 用户昵称     |                              |
| city_id         | integer  | ？       | F8       | 城市id       |                              |
| city_name       | string   | ?        | V32      | 城市名称     |                              |
| real_name_reg   | integer  | 1        | F2       | 实名登记标志 | 0-未登记  1-已登记     0要素 |
| real_name_auth  | integer  | 1        | F2       | 实名认证标志 | 0-未认证  1-已认证  2要素    |
| real_name_chk   | integer  | 1        | F2       | 实名校验标志 | 0-已实名  1-未实名  4要素    |
| real_name_open  | integer  | 1        | F2       | 是否开户标记 | 0-已开户  1-未开户  2要素    |

 

## 5.2  用户画像信息



| **元素名称**         | **类型** | **约束** | **宽度** | **参数描述**     | **备注**                                                     |
| -------------------- | -------- | -------- | -------- | ---------------- | ------------------------------------------------------------ |
| portrais             | struct   | 1        | -        | 用户画像标签信息 |                                                              |
| BWT_CPL_INDM_GEND_S  | string   | 1        | V64      | 性别             | 行为性别，F：女性，M：男性                                   |
| BWT_CPL_INDM_NATI    | string   | 1        | V64      | 国籍             | 国籍。取值：  中国, 其他                                     |
| BWT_CPL_INDM_AGE_C5  | string   | 1        | V64      | 年龄段           | 年龄段  0:<15岁,   1:15-20岁,   2:20~25岁,   3:25~30岁,   4:30-35岁,   ……   12:>70岁 |
| BWT_CPL_INDM_AGE_DEC | string   | 1        | V64      | 出生年代         | 出生年代  0:50前   1:50后,   2:55后,   3:60后,   4:65后,   5:70后,   6:75后,   7:80后,   …… |
| BWT_ABM_LBS_IDADRS   | string   | 1        | V64      | 籍贯地址         | 用户身份证归属地                                             |
| BWT_ABM_LBS_PHNADRS  | string   | 1        | V64      | 手机号归属地址   | 用户手机号初始归属地。基于第3方数据源。                      |
| BWT_CID_MODEL        | string   | 1        | V64      | 手机型号         | 手机型号                                                     |
| BWT_CPL_DVM_ISP      | string   | 1        | V64      | 运营商           | 运营商                                                       |
| BWT_CPL_DVM_OS       | string   | ？       | V64      | 操作系统         | 操作系统                                                     |
| BWT_TH_SUB_ATCW      | string   | ？       | V64      | 周均乘车次数     | 平均每周乘车次数。  0:<1次，   1:1-2次，   2:2-5次，   3:5-6次，   4:>6次 |
| BWT_TH_SUB_ATCM      | string   | ？       | V64      | 月均乘车次数     | 平均每月乘车次数。  0:<1次，   1:1-2次，   2:2-5次，   3:5-10次，   4:10-15次，   5:15-25次，   6:>25次 |
| BWT_TH_SUB_ATP       | string   | ？       | V64      | 平均票价         | 平均票价，按原价计算。  0:2-3元，   1:3-4元，   2:4-5元，   3:5-6元，   4:6-7元，   5:7-8元  6:>8元 |
| BWT_TH_SUB_FREP      | string   | ？       | V64      | 是否常旅客       | 取值：Y,N                                                    |
| BWT_TH_SUB_REGP      | string   | ？       | V64      | 是否规律旅客     | 取值：Y,N                                                    |
| BWT_TH_SUB_HOMEP     | string   | ？       | V64      | 居住地站点       | 站点编号                                                     |
| BWT_TH_SUB_WORKP     | string   | ？       | V64      | 工作地站点       | 站点编号                                                     |
| BWT_TH_SUB_OFP       | string   | ？       | V64      | 常去站点         | 站点编号                                                     |



 